// Underscore.js 1.3.3
// (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
// Underscore is freely distributable under the MIT license.
// Portions of Underscore are inspired or borrowed from Prototype,
// Oliver Steele's Functional, and John Resig's Micro-Templating.
// For all details and documentation:
// http://documentcloud.github.com/underscore
(function(){function e(t,n,r){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return t===n;t._chain&&(t=t._wrapped),n._chain&&(n=n._wrapped);if(t.isEqual&&E.isFunction(t.isEqual))return t.isEqual(n);if(n.isEqual&&E.isFunction(n.isEqual))return n.isEqual(t);var i=a.call(t);if(i!=a.call(n))return!1;switch(i){case"[object String]":return t==""+n;case"[object Number]":return t!=+t?n!=+n:0==t?1/t==1/n:t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if("object"!=typeof t||"object"!=typeof n)return!1;for(var s=r.length;s--;)if(r[s]==t)return!0;r.push(t);var s=0,o=!0;if("[object Array]"==i){if(s=t.length,o=s==n.length)for(;s--&&(o=s in t==s in n&&e(t[s],n[s],r)););}else{if("constructor"in t!="constructor"in n||t.constructor!=n.constructor)return!1;for(var u in t)if(E.has(t,u)&&(s++,!(o=E.has(n,u)&&e(t[u],n[u],r))))break;if(o){for(u in n)if(E.has(n,u)&&!(s--))break;o=!s}}return r.pop(),o}var t=this,n=t._,r={},i=Array.prototype,s=Object.prototype,o=i.slice,u=i.unshift,a=s.toString,f=s.hasOwnProperty,l=i.forEach,c=i.map,h=i.reduce,p=i.reduceRight,d=i.filter,v=i.every,m=i.some,g=i.indexOf,y=i.lastIndexOf,s=Array.isArray,b=Object.keys,w=Function.prototype.bind,E=function(e){return new _(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=E),exports._=E):t._=E,E.VERSION="1.3.3";var S=E.each=E.forEach=function(e,t,n){if(e!=null)if(l&&e.forEach===l)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(i in e&&t.call(n,e[i],i,e)===r)break}else for(i in e)if(E.has(e,i)&&t.call(n,e[i],i,e)===r)break};E.map=E.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(S(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},E.reduce=E.foldl=E.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=E.bind(t,r)),i?e.reduce(t,n):e.reduce(t);S(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},E.reduceRight=E.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduceRight===p)return r&&(t=E.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=E.toArray(e).reverse();return r&&!i&&(t=E.bind(t,r)),i?E.reduce(s,t,n,r):E.reduce(s,t)},E.find=E.detect=function(e,t,n){var r;return x(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},E.filter=E.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(S(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},E.reject=function(e,t,n){var r=[];return e==null?r:(S(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},E.every=E.all=function(e,t,n){var i=!0;return e==null?i:v&&e.every===v?e.every(t,n):(S(e,function(e,s,o){if(!(i=i&&t.call(n,e,s,o)))return r}),!!i)};var x=E.some=E.any=function(e,t,n){t||(t=E.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,n):(S(e,function(e,s,o){if(i||(i=t.call(n,e,s,o)))return r}),!!i)};E.include=E.contains=function(e,t){var n=!1;return e==null?n:g&&e.indexOf===g?e.indexOf(t)!=-1:n=x(e,function(e){return e===t})},E.invoke=function(e,t){var n=o.call(arguments,2);return E.map(e,function(e){return(E.isFunction(t)?t||e:e[t]).apply(e,n)})},E.pluck=function(e,t){return E.map(e,function(e){return e[t]})},E.max=function(e,t,n){if(!t&&E.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&E.isEmpty(e))return-Infinity;var r={computed:-Infinity};return S(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i>=r.computed&&(r={value:e,computed:i})}),r.value},E.min=function(e,t,n){if(!t&&E.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&E.isEmpty(e))return Infinity;var r={computed:Infinity};return S(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i<r.computed&&(r={value:e,computed:i})}),r.value},E.shuffle=function(e){var t=[],n;return S(e,function(e,r){n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e}),t},E.sortBy=function(e,t,n){var r=E.isFunction(t)?t:function(e){return e[t]};return E.pluck(E.map(e,function(e,t,i){return{value:e,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n===void 0?1:r===void 0?-1:n<r?-1:n>r?1:0}),"value")},E.groupBy=function(e,t){var n={},r=E.isFunction(t)?t:function(e){return e[t]};return S(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},E.sortedIndex=function(e,t,n){n||(n=E.identity);for(var r=0,i=e.length;r<i;){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},E.toArray=function(e){return e?E.isArray(e)||E.isArguments(e)?o.call(e):e.toArray&&E.isFunction(e.toArray)?e.toArray():E.values(e):[]},E.size=function(e){return E.isArray(e)?e.length:E.keys(e).length},E.first=E.head=E.take=function(e,t,n){return t!=null&&!n?o.call(e,0,t):e[0]},E.initial=function(e,t,n){return o.call(e,0,e.length-(t==null||n?1:t))},E.last=function(e,t,n){return t!=null&&!n?o.call(e,Math.max(e.length-t,0)):e[e.length-1]},E.rest=E.tail=function(e,t,n){return o.call(e,t==null||n?1:t)},E.compact=function(e){return E.filter(e,function(e){return!!e})},E.flatten=function(e,t){return E.reduce(e,function(e,n){return E.isArray(n)?e.concat(t?n:E.flatten(n)):(e[e.length]=n,e)},[])},E.without=function(e){return E.difference(e,o.call(arguments,1))},E.uniq=E.unique=function(e,t,n){var n=n?E.map(e,n):e,r=[];return e.length<3&&(t=!0),E.reduce(n,function(n,i,s){if(t?E.last(n)!==i||!n.length:!E.include(n,i))n.push(i),r.push(e[s]);return n},[]),r},E.union=function(){return E.uniq(E.flatten(arguments,!0))},E.intersection=E.intersect=function(e){var t=o.call(arguments,1);return E.filter(E.uniq(e),function(e){return E.every(t,function(t){return E.indexOf(t,e)>=0})})},E.difference=function(e){var t=E.flatten(o.call(arguments,1),!0);return E.filter(e,function(e){return!E.include(t,e)})},E.zip=function(){for(var e=o.call(arguments),t=E.max(E.pluck(e,"length")),n=Array(t),r=0;r<t;r++)n[r]=E.pluck(e,""+r);return n},E.indexOf=function(e,t,n){if(e==null)return-1;var r;if(n)return n=E.sortedIndex(e,t),e[n]===t?n:-1;if(g&&e.indexOf===g)return e.indexOf(t);n=0;for(r=e.length;n<r;n++)if(n in e&&e[n]===t)return n;return-1},E.lastIndexOf=function(e,t){if(e==null)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);for(var n=e.length;n--;)if(n in e&&e[n]===t)return n;return-1},E.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0);for(var n=arguments[2]||1,r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);i<r;)s[i++]=e,e+=n;return s};var T=function(){};E.bind=function(e,t){var n,r;if(e.bind===w&&w)return w.apply(e,o.call(arguments,1));if(!E.isFunction(e))throw new TypeError;return r=o.call(arguments,2),n=function(){if(this instanceof n){T.prototype=e.prototype;var i=new T,s=e.apply(i,r.concat(o.call(arguments)));return Object(s)===s?s:i}return e.apply(t,r.concat(o.call(arguments)))}},E.bindAll=function(e){var t=o.call(arguments,1);return t.length==0&&(t=E.functions(e)),S(t,function(t){e[t]=E.bind(e[t],e)}),e},E.memoize=function(e,t){var n={};return t||(t=E.identity),function(){var r=t.apply(this,arguments);return E.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},E.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},E.defer=function(e){return E.delay.apply(E,[e,1].concat(o.call(arguments,1)))},E.throttle=function(e,t){var n,r,i,s,o,u,a=E.debounce(function(){o=s=!1},t);return function(){return n=this,r=arguments,i||(i=setTimeout(function(){i=null,o&&e.apply(n,r),a()},t)),s?o=!0:u=e.apply(n,r),a(),s=!0,u}},E.debounce=function(e,t,n){var r;return function(){var i=this,s=arguments;n&&!r&&e.apply(i,s),clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(i,s)},t)}},E.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},E.wrap=function(e,t){return function(){var n=[e].concat(o.call(arguments,0));return t.apply(this,n)}},E.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},E.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},E.keys=b||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[],n;for(n in e)E.has(e,n)&&(t[t.length]=n);return t},E.values=function(e){return E.map(e,E.identity)},E.functions=E.methods=function(e){var t=[],n;for(n in e)E.isFunction(e[n])&&t.push(n);return t.sort()},E.extend=function(e){return S(o.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},E.pick=function(e){var t={};return S(E.flatten(o.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},E.defaults=function(e){return S(o.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},E.clone=function(e){return E.isObject(e)?E.isArray(e)?e.slice():E.extend({},e):e},E.tap=function(e,t){return t(e),e},E.isEqual=function(t,n){return e(t,n,[])},E.isEmpty=function(e){if(e==null)return!0;if(E.isArray(e)||E.isString(e))return e.length===0;for(var t in e)if(E.has(e,t))return!1;return!0},E.isElement=function(e){return!!e&&e.nodeType==1},E.isArray=s||function(e){return a.call(e)=="[object Array]"},E.isObject=function(e){return e===Object(e)},E.isArguments=function(e){return a.call(e)=="[object Arguments]"},E.isArguments(arguments)||(E.isArguments=function(e){return!!e&&!!E.has(e,"callee")}),E.isFunction=function(e){return a.call(e)=="[object Function]"},E.isString=function(e){return a.call(e)=="[object String]"},E.isNumber=function(e){return a.call(e)=="[object Number]"},E.isFinite=function(e){return E.isNumber(e)&&isFinite(e)},E.isNaN=function(e){return e!==e},E.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},E.isDate=function(e){return a.call(e)=="[object Date]"},E.isRegExp=function(e){return a.call(e)=="[object RegExp]"},E.isNull=function(e){return e===null},E.isUndefined=function(e){return e===void 0},E.has=function(e,t){return f.call(e,t)},E.noConflict=function(){return t._=n,this},E.identity=function(e){return e},E.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},E.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},E.result=function(e,t){if(e==null)return null;var n=e[t];return E.isFunction(n)?n.call(e):n},E.mixin=function(e){S(E.functions(e),function(t){P(t,E[t]=e[t])})};var N=0;E.uniqueId=function(e){var t=N++;return e?e+t:t},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var C=/.^/,k={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"},L;for(L in k)k[k[L]]=L;var A=/\\|'|\r|\n|\t|\u2028|\u2029/g,O=/\\(\\|'|r|n|t|u2028|u2029)/g,M=function(e){return e.replace(O,function(e,t){return k[t]})};E.template=function(e,t,n){n=E.defaults(n||{},E.templateSettings),e="__p+='"+e.replace(A,function(e){return"\\"+k[e]}).replace(n.escape||C,function(e,t){return"'+\n_.escape("+M(t)+")+\n'"}).replace(n.interpolate||C,function(e,t){return"'+\n("+M(t)+")+\n'"}).replace(n.evaluate||C,function(e,t){return"';\n"+M(t)+"\n;__p+='"})+"';\n",n.variable||(e="with(obj||{}){\n"+e+"}\n");var e="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+e+"return __p;\n",r=new Function(n.variable||"obj","_",e);return t?r(t,E):(t=function(e){return r.call(this,e,E)},t.source="function("+(n.variable||"obj")+"){\n"+e+"}",t)},E.chain=function(e){return E(e).chain()};var _=function(e){this._wrapped=e};E.prototype=_.prototype;var D=function(e,t){return t?E(e).chain():e},P=function(e,t){_.prototype[e]=function(){var e=o.call(arguments);return u.call(e,this._wrapped),D(t.apply(E,e),this._chain)}};E.mixin(E),S("pop,push,reverse,shift,sort,splice,unshift".split(","),function(e){var t=i[e];_.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return(e=="shift"||e=="splice")&&r===0&&delete n[0],D(n,this._chain)}}),S(["concat","join","slice"],function(e){var t=i[e];_.prototype[e]=function(){return D(t.apply(this._wrapped,arguments),this._chain)}}),_.prototype.chain=function(){return this._chain=!0,this},_.prototype.value=function(){return this._wrapped}}).call(this);var Kona,__hasProp={}.hasOwnProperty;Kona=window.Kona={},Kona.debugMode=!0,Kona.debug=function(e){var t,n,r,i,s,o,u,a,f,l,c;if(Kona.debugMode){a=function(e){return console.log(e)},t=e!=null?"":"<undefined>",f="  ",n=_.isArray(e),o=_.isString(e),i=_.isNumber(e),r=_.isBoolean(e),s=_.isObject(e),e==null&&a("<undefined>"),(n||s)&&a("Dumping "+(n?"array":typeof e)+": "+t);if(n)return a(""+f+"["+e+"]");if(o)return a(e);if(i)return a(e);if(r)return a(e.toString());if(s){c=[];for(u in e){if(!__hasProp.call(e,u))continue;l=e[u],_.isFunction(l)?c.push(a(""+f+u+"(): <function>")):c.push(a(""+f+u+": "+l))}return c}}},Kona.readyCallbacks=[],Kona.isReady=!1,Kona.ready=function(e){return document.readyState==="complete"&&(Kona.isReady=!0),Kona.isReady&&e.call(),Kona.readyCallbacks.push(e)},Kona.DOMContentLoaded=function(){var e,t,n,r,i;if(Kona.isReady)return;Kona.isReady=!0,r=Kona.readyCallbacks,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.call());return i},document.readyState!=="complete"&&(document.addEventListener?(document.addEventListener("DOMContentLoaded",Kona.DOMContentLoaded,!1),window.addEventListener("load",Kona.DOMContentLoaded,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",Kona.DOMContentLoaded),window.attachEvent("onload",Kona.DOMContentLoaded))),Kona.Utils={printGrid:function(e){var t,n,r,i,s,o,u,a;r="[\n";for(s=0,u=e.length;s<u;s++){i=e[s],r+="  [";for(t=o=0,a=i.length;o<a;t=++o)n=i[t],r+=""+n,t!==i.length-1&&(r+=", ");r+="]\n"}return console.log(""+r+"]")},colorFor:function(e){switch(e){case 1:return"red";case 2:return"orange";case 3:return"blue"}},randomFromTo:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},findByKey:function(e,t,n){return _.find(e,function(e){return e[t]===n})}},Kona.Canvas={defaults:{width:640,height:480},init:function(e){return e==null&&(e={}),this.elem=document.getElementById(e.id)||function(){throw new Error("cant build canvas with id: "+id)}(),this.ctx=this.elem.getContext("2d"),this.width=this.elem.width||this.defaults.width,this.height=this.elem.height||this.defaults.height},safe:function(e){return this.ctx.save(),e(),this.ctx.restore()},clear:function(){var e=this;return this.safe(function(){return e.ctx.fillStyle="white",e.ctx.fillRect(0,0,e.width,e.height)})},verticalLine:function(e){var t=this;return this.safe(function(){return t.ctx.fillStyle="red",t.ctx.fillRect(e,0,2,t.height)})},highlightColumn:function(e){var t=this;return Kona.Canvas.safe(function(){return Kona.Canvas.ctx.fillStyle="red",Kona.Canvas.ctx.globalAlpha=.1,Kona.Canvas.ctx.fillRect(e.position.x,0,Kona.Tile.tileSize,Kona.Canvas.height)})}},Kona.Engine={defaults:{fps:24,width:640,height:480},start:function(e){return this.fps=e.fps||this.defaults.fps,Kona.Scenes.currentScene=Kona.Utils.findByKey(Kona.Scenes._scenes,"active",!0),this.run()},run:function(){return Kona.Scenes.drawCurrent(),requestAnimFrame(Kona.Engine.run)}},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1e3/Kona.Engine.defaults.fps)}}(),Kona.Scenes={_scenes:[],currentScene:{},drawCurrent:function(){return this.currentScene.draw()},setCurrent:function(e){return this.currentScene.active=!1,this.currentScene=Kona.Utils.findByKey(this._scenes,"name",e),this.currentScene.active=!0}},Kona.Scene=function(){function e(e){e==null&&(e={}),this.active=e.active||!1,this.name=e.name||function(){throw new Error("scene must have a name")}(),this.background=new Image,this.background.src=e.background||"",this.entities=[],Kona.Scenes._scenes.push(this)}return e.prototype.addEntity=function(e){return this.entities.push(e)},e.prototype.setLayout=function(e){var t,n,r,i,s,o;o=[];for(i=0,s=e.length;i<s;i++)t=e[i],n=t.entity,o.push(function(){var e,i,s,o;s=t.layout,o=[];for(e=0,i=s.length;e<i;e++)r=s[e],o.push(this.addEntity(new n(r)));return o}.call(this));return o},e.prototype.update=function(){return console.log("scene update called")},e.prototype.draw=function(){var e,t,n,r,i;Kona.Canvas.clear(),Kona.Canvas.ctx.drawImage(this.background,0,0),Kona.TileManager.draw(this.name),r=this.entities,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],e.update(),i.push(e.draw());return i},e}(),Kona.Entity=function(){function e(e){e==null&&(e={}),this.solid=!0,this.position={x:e.x||0,y:e.y||0},this.direction={dx:e.dx||0,dy:e.dy||0},this.box={width:e.width||0,height:e.height||0},this.sprite=new Image,this.sprite.src=""}return e.prototype.update=function(){},e.prototype.draw=function(){},e.prototype.top=function(){return this.position.y},e.prototype.bottom=function(){return this.position.y+this.box.height},e.prototype.left=function(){return this.position.x},e.prototype.right=function(){return this.position.x+this.box.width},e.prototype.futureTop=function(){return this.position.y+this.direction.dy},e.prototype.futureBottom=function(){return this.bottom()+this.direction.dy},e.prototype.futureLeft=function(){return this.position.x+this.direction.dx},e.prototype.futureRight=function(){return this.right()+this.direction.dx},e.prototype.movingLeft=function(){return this.direction.dx<0},e.prototype.movingRight=function(){return this.direction.dx>0},e.prototype.leftCollision=function(){var e,t,n,r,i,s,o,u;t=!1,u=Kona.TileManager.columnsFor(this);for(r=0,s=u.length;r<s;r++){e=u[r];for(i=0,o=e.length;i<o;i++){n=e[i];if(!n.solid||this.left()>n.right())continue;this.right()>=n.right()&&this.futureLeft()<=n.right()&&this.futureBottom()>n.top()&&this.futureTop()<n.bottom()&&(t=!0)}}return t},e.prototype.rightCollision=function(){var e,t,n,r,i,s,o,u;t=!1,u=Kona.TileManager.columnsFor(this);for(r=0,s=u.length;r<s;r++){e=u[r];for(i=0,o=e.length;i<o;i++){n=e[i];if(!n.solid||this.right()<n.left())continue;this.left()<=n.left()&&this.futureRight()>=n.left()&&this.futureBottom()>n.top()&&this.futureTop()<n.bottom()&&(t=!0)}}return t},e.prototype.stop=function(e){if(e!=null)return _.contains(["dx","dy"],e)||function(){throw new Error("Axis "+e+" not recognized")}(),this.direction[e]=0},e}();var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};Kona.TileManager={sceneTilemap:{},tiles:[],buildTiles:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;(a=this.sceneTilemap)[e]||(a[e]=[]),o=0,u=Kona.Canvas.height-t.length*Kona.Tile.tileSize,i=[],p=[];for(f=0,c=t.length;f<c;f++){r=t[f];for(l=0,h=r.length;l<h;l++)n=r[l],s=n===0?new Kona.BlankTile({x:o,y:u}):new Kona.Tile({color:n,x:o,y:u}),i.push(s),o+=Kona.Tile.tileSize;o=0,u+=Kona.Tile.tileSize,this.sceneTilemap[e].push(i),p.push(i=[])}return p},draw:function(e){var t,n,r,i,s,o;s=this.sceneTilemap[e],o=[];for(r=0,i=s.length;r<i;r++)t=s[r],o.push(function(){var e,r,i;i=[];for(e=0,r=t.length;e<r;e++)n=t[e],i.push(n.draw());return i}());return o},columnFor:function(e){var t,n,r,i,s;t=[],s=this.sceneTilemap[Kona.Scenes.currentScene.name];for(r=0,i=s.length;r<i;r++)n=s[r],t.push(n[e]);return t},columnsFor:function(e){var t,n,r,i,s,o;s=Math.floor(e.position.x/Kona.Tile.tileSize),t=Math.floor((e.position.x+e.box.width)/Kona.Tile.tileSize),n=this.sceneTilemap[Kona.Scenes.currentScene.name],i=[];for(r=o=s;s<=t?o<=t:o>=t;r=s<=t?++o:--o)i.push(this.columnFor(r));return i}},Kona.Tile=function(e){function t(e){t.__super__.constructor.call(this,e),this.size=Kona.Tile.tileSize,this.box={width:this.size,height:this.size},this.color=e.color||-1}return __extends(t,e),t.tileSize=60,t.prototype.toString=function(){return"<Tile @color="+Kona.Utils.colorFor(this.color)+">"},t.prototype.draw=function(){var e=this;return Kona.Canvas.safe(function(){return Kona.Canvas.ctx.fillStyle=Kona.Utils.colorFor(e.color),Kona.Canvas.ctx.fillRect(e.position.x,e.position.y,e.box.width,e.box.height)})},t}(Kona.Entity),Kona.BlankTile=function(e){function t(e){t.__super__.constructor.call(this,e),this.solid=!1,this.size=Kona.Tile.tileSize,this.box={width:this.size,height:this.size}}return __extends(t,e),t.prototype.toString=function(){return"<BlankTile>"},t.prototype.draw=function(){return Kona.Canvas.ctx.strokeRect(this.position.x,this.position.y,this.box.width,this.box.height)},t}(Kona.Entity),Kona.Keys={_handlers:{},_keycodes:{enter:13,"return":13,esc:27,escape:27,ctrl:17,control:17,left:37,up:38,right:39,down:40,shift:16,space:32},_names:{13:"enter",16:"shift",17:"ctrl",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z"},bind:function(e,t){var n,r;return e=e.replace(/\s/g,""),n=this._keycodes[e]||e.toUpperCase().charCodeAt(0),(r=this._handlers)[n]||(r[n]=[]),this._handlers[n].push(t)},dispatch:function(e){var t,n,r,i,s,o;n=this.eventKeyCode(e);if(this.reject(e)||this._handlers[n]==null)return;s=this._handlers[n],o=[];for(r=0,i=s.length;r<i;r++)t=s[r],t.call(e),o.push(!1);return o},reject:function(e){return _.contains(["INPUT","SELECT","TEXTAREA"],e.target.tagName)},keycodeName:function(e){return this._names[this.eventKeyCode(e)]},eventKeyCode:function(e){return e.which||e.keyCode}},Kona.ready(function(){return document.body.onkeydown=function(e){var t;t=Kona.Keys.keycodeName(e);if(Kona.Keys.keydown)return Kona.Keys.keydown(t)},document.body.onkeyup=function(e){var t;t=Kona.Keys.keycodeName(e);if(Kona.Keys.keyup)return Kona.Keys.keyup(t)},document.addEventListener("keydown",Kona.Keys.dispatch.bind(Kona.Keys),!1)}),Kona.Sound={defaults:{autoplay:!1,duration:5e3,formats:[],loop:!1,placeholder:"--",preload:"metadata",volume:80},types:{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",m4a:"audio/x-m4a"},sounds:[],el:document.createElement("audio"),all:function(){return new this.group(this.sounds)},isSupported:function(){return!!this.el.canPlayType},isOGGSupported:function(){return!!this.el.canPlayType&&this.el.canPlayType('audio/ogg codecs="vorbis"')},isWAVSupported:function(){return!!this.el.canPlayType&&this.el.canPlayType('audio/wav codecs="1"')},isMP3Supported:function(){return!!this.el.canPlayType&&this.el.canPlayType("audio/mpeg")},isAACSupported:function(){return!!this.el.canPlayType&&(this.el.canPlayType("audio/x-m4a")||this.el.canPlayType("audio/aac"))},toTimer:function(e,t){var n,r,i,s;return n=function(e){return isNaN(e)?"--":e<10?"0"+e:e},r=Math.floor(e/3600),r=n(r),i=t?Math.floor(e/60%60):Math.floor(e/60),i=n(i),s=Math.floor(e%60),s=n(s),t?""+r+":"+i+":"+s:""+i+":"+s},fromTimer:function(e){var t;return t=e.toString().split(":"),t&&t.length===3&&(e=parseInt(t[0],10)*3600+parseInt(t[1],10)*60+parseInt(t[2],10)),t&&t.length===2&&(e=parseInt(t[0],10)*60+parseInt(t[1],10)),e},toPercent:function(e,t,n){var r;return r=Math.pow(10,n||0),Math.round(e*100/t*r)/r},fromPercent:function(e,t,n){var r;return r=Math.pow(10,n||0),Math.round(t/100*e*r)/r},timeRangeToArray:function(e){var t,n,r,i;r=[],t=e.length-1;for(n=i=0;0<=t?i<=t:i>=t;n=0<=t?++i:--i)r.push({start:e.start(t),end:e.end(t)});return r},getExt:function(e){return e.split(".").pop()},addSource:function(e,t){var n;return n=document.createElement("source"),n.src=t,Kona.Sound.types[getExt(t)]!=null&&(n.type=Kona.Sound.types[getExt(t)]),e.appendChild(n)},sound:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;t==null&&(t={}),s=0,n=[],r={},u=Kona.Sound.isSupported();if(u&&e){v=Kona.Sound.defaults;for(a=f=0,h=v.length;f<h;a=++f)i=v[a],t[i]=t[i]||a;this.sound=document.createElement("audio");if(_.isArray(e)){console.log(e);for(l=0,p=e.length;l<p;l++)o=e[l],addSource(this.sound,o)}else if(t.formats.length){console.log(t.formats),m=t.formats;for(a=c=0,d=m.length;c<d;a=++c)i=m[a],addSource(this.sound,""+e+"."+i)}else addSource(this.sound,e);t.loop&&this.loop(),t.autoplay&&(this.sound.autoplay="autoplay"),t.preload===!0?this.sound.preload="auto":t.preload===!1?this.sound.preload="none":this.sound.preload=t.preload,this.setVolume(t.volume),Kona.Sound.sounds.push(this)}return this.load=function(){return u?this.sound.load():this},this.play=function(){return u?this.sound.play():this},this.togglePlay=function(){return u?(this.sound.paused?this.sound.play():this.sound.pause(),this):this},this.pause=function(){return u?this.sound.pause():this},this.isPaused=function(){return u?this.sound.paused:null},this.stop=function(){return u?(this.setTime(this.getDuration()),this.sound.pause(),this):this},this.isEnded=function(){return u?this.sound.ended:null},this.loop=function(){return u?(this.sound.loop="loop",this.bind("ended.buzzloop",function(){return this.currentTime=0,this.play()}),this):this},this.unloop=function(){return u?(this.sound.removeAttribute("loop"),this.unbind("ended.buzzloop"),this):this},this.mute=function(){return u?(this.sound.muted=!0,this):this},this.unmute=function(){return u?this.sound.muted=!1:null},this.toggleMute=function(){return u?this.sound.muted=!this.sound.muted:null},this.isMuted=function(){return u?this.sound.muted:null},this.setVolume=function(e){return u?(e<0&&(e=0),e>100&&(e=100),this.volume=e,this.sound.volume=e/100,this):this},this.getVolume=function(){return u?this.volume=!1:null},this.increaseVolume=function(e){return e==null&&(e=1),this.setVolume(this.volume+e)},this.decreaseVolume=function(e){return e==null&&(e=1),this.setVolume(this.volume-e)},this.setTime=function(e){return u?this.whenReady(function(){return this.sound.currentTime=e,this}):this},this.getTime=function(){var e;return u?(e=Math.round(this.sound.currentTime*100)/100,isNaN(e)?buzz.defaults.placeholder:e):null},this.setPercent=function(e){return u?this.setTime(buzz.fromPercent(e,this.sound.duration)):this},this.getPercent=function(){var e;return u?(e=Math.round(buzz.toPercent(this.sound.currentTime,this.sound.duration)),isNaN(e)?buzz.defaults.placeholder:e):this},this.setSpeed=function(e){return u?this.sound.playbackRate=e:null},this.getSpeed=function(){return u?this.sound.playbackRate:null},this.getDuration=function(){var e;return u?(e=Math.round(this.sound.duration*100)/100,isNaN(e)?buzz.defaults.placeholder:e):null},this.getPlayed=function(){return u?timerangeToArray(this.sound.played):null},this.getBuffered=function(){return u?timerangeToArray(this.sound.buffered):null},this.getSeekable=function(){return u?timerangeToArray(this.sound.seekable):null},this.getErrorCode=function(){return u&&this.sound.error?this.sound.error.code:0},this.getErrorMessage=function(){if(!u)return null;switch(this.getErrorCode){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return null}},this.getStateCode=function(){return u?this.sound.readyState:null},this.getStateMessage=function(){if(!u)return null;switch(this.getStateCode){case 0:return"HAVE_NOTHING";case 1:return"HAVE_METADATA";case 2:return"HAVE_CURRENT_DATA";case 3:return"HAVE_FUTURE_DATA";case 4:return"HAVE_ENOUGH_DATA";default:return null}},this.getNetworkStateCode=function(){return u?this.sound.networkState:null},this.getNetworkStateMessage=function(){if(!u)return null;switch(this.getNetworkStateCode){case 0:return"NETWORK_EMPTY";case 1:return"NETWORK_IDLE";case 2:return"NETWORK_LOADING";case 3:return"NETWORK_NO_SOURCE";default:return null}},this.set=function(e,t){return u?this.sound[e]=t:this},this.get=function(e){return u?e!=null?this.sound[e]:this.sound:null},this.bind=function(e,t){var r,i,s,o,a,f;if(!u)return this;e=e.split(" "),s=this,r=function(e){return t.call(s,e)};for(a=0,f=e.length;a<f;a++)o=e[a],i=o,o=i.split(".")[0],n.push({idx:i,func:r}),this.sound.addEventListener(o,r,!0);return this},this.unbind=function(e){var t,r,i,s,o,a,f,l,c;if(!u)return this;e=e.split(" ");for(a=0,f=e.length;a<f;a++){o=e[a],i=o,o=i.split(".")[0];for(r=c=0,l=n.length;c<l;r=++c){t=n[r],s=t.idx.split(".");if(t.idx===i||s[1]&&s[1]===i.replace(".",""))this.sound.removeEventListener(o,t.func,!0),n.splice(r,1)}}return this},this.bindOnce=function(e,t){var n;return u?(n=this,r[s++]=!1,this.bind(s+e,function(){if(!r[s])return r[s]=!0,t.call(n),this.unbind(s+e)})):this},this.trigger=function(e){var t,r,i,s,o,a,f,l,c;if(!u)return this;e=e.split(" ");for(a=0,f=e.length;a<f;a++){o=e[a],s=o;for(c=0,l=n.length;c<l;c++){t=n[c],r=t.idx.split(".");if(t.idx===s||r[0]&&r[0]===s.replace(".",""))i=document.createEvent("HTMLEvents"),i.initEvent(r[0],!1,!0),this.sound.dispatchEvent(i)}}return this},this.fadeTo=function(e,t,n){var r,i,s,o;return u?(t instanceof Function?(n=t,t=Kona.Sound.defaults.duration):t=t||Kona.Sound.defaults.duration,s=this.volume,r=t/Math.abs(s-e),o=this,this.play(),i=function(){return setTimeout(function(){if(s<e&&o.volume<e)return o.setVolume(o.volume+=1),i();if(s>e&&o.volume>e)return o.setVolume(o.volume-=1),i();if(n instanceof Function)return n.apply(o)},r)},this.whenReady(function(){return i()}),this):this},this.fadeIn=function(e,t){return u?this.setVolume(0).fadeTo(100,e,t):this},this.fadeOut=function(e,t){return u?this.fadeTo(0,e,t):this},this.fadeWith=function(e,t){return u?(this.fadeOut(t,function(){return this.stop()}),e.play().fadeIn(t),this):this},this.whenReady=function(e){var t;return u?(t=this,this.sound.readyState===0?this.bind("canplay.buzzwhenready",function(){return e.call(t)}):e.call(t)):null}},group:function(e){var t,n;return e=t(e,arguments),this.getSounds=function(){return e},this.add=function(n){var r,i,s,o;n=t(n,arguments),o=[];for(i=0,s=n.length;i<s;i++)r=n[i],o.push(e.push(r));return o},this.load=function(){return n("load"),this},this.play=function(){return n("play"),this},this.togglePlay=function(){return n("togglePlay"),this},this.pause=function(e){return n("pause",e),this},this.stop=function(){return n("stop"),this},this.mute=function(){return n("mute"),this},this.unmute=function(){return n("unmute"),this},this.toggleMute=function(){return n("toggleMute"),this},this.setVolume=function(e){return n("setVolume",e),this},this.increaseVolume=function(e){return n("increaseVolume",e),this},this.decreaseVolume=function(e){return n("decreaseVolume",e),this},this.loop=function(){return n("loop"),this},this.unloop=function(){return n("unloop"),this},this.setTime=function(e){return n("setTime",e),this},this.setDuration=function(e){return n("setDuration",e),this},this.set=function(e,t){return n("set",e,t),this},this.bind=function(e,t){return n("bind",e,t),this},this.unbind=function(e){return n("unbind",e),this},this.bindOnce=function(e,t){return n("bindOnce",e,t),this},this.trigger=function(e){return n("trigger",e),this},this.fade=function(e,t,r,i){return n("fade",e,t,r,i),this},this.fadeIn=function(e,t){return n("fadeIn",e,t),this},this.fadeOut=function(e,t){return n("fadeOut",e,t),this},n=function(){var n,r,i,s,o,u;n=t(null,arguments),r=n.shift(),u=[];for(s=0,o=e.length;s<o;s++)i=e[s],u.push(i[r].apply(i,n));return u},t=function(e,t){return _.isArray(e)?e:Array.prototype.slice.call(t)}}};var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};Kona.ready(function(){var e,t,n,r,i;return window.KUtils=Kona.Utils,window.KCanvas=Kona.Canvas,window.KEngine=Kona.Engine,window.KScenes=Kona.Scenes,window.KEntity=Kona.Entity,window.KTiles=Kona.TileManager,window.KKeys=Kona.Keys,window.KSound=Kona.Sound,Kona.beat=function(){return console.log("Heartbeat!")},window._k_once=0,window.once=function(e){return window._k_once===0&&e(),window._k_once++},Kona.Canvas.init({id:"canvas"}),t=new Kona.Scene({name:"level-1",active:!0}),e=function(e){function t(e){this.isJumping=!1,t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.update=function(){var e,t,n;e=Kona.Canvas.height,n=12,t=5;if(this.futureLeft()<0||this.leftCollision()&&this.movingLeft())this.direction.dx=0;if(this.futureRight()>Kona.Engine.C_WIDTH||this.rightCollision()&&this.movingRight())this.direction.dx=0;this.position.x+=this.direction.dx;if(this
.isJumping)return this.position.y+=this.futureTop()<0?0:-n;if(this.bottom()<e)return this.position.y+=this.bottom()+t>e?e-this.bottom():t},t.prototype.draw=function(){return Kona.Canvas.ctx.fillRect(this.position.x,this.position.y,this.box.width,this.box.height)},t.prototype.jump=function(){var e,t=this;return e=175,this.isJumping?!1:(this.isJumping=!0,setTimeout(function(){return t.isJumping=!1},e))},t}(Kona.Entity),r=new e({x:260,y:200,width:30,height:60}),t.addEntity(r),n=3,Kona.Keys.keydown=function(e){switch(e){case"left":return r.direction.dx=-n;case"right":return r.direction.dx=n;case"up":return r.jump()}},Kona.Keys.keyup=function(e){switch(e){case"left":case"right":return r.stop("dx");case"up":case"down":return r.stop("dy")}},i=[[0,0,0,0,0,0,0,0,2,3,1],[0,0,0,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,0,0,0,0,3],[1,0,2,3,0,0,1,2,3,0,2],[3,0,1,2,3,0,0,1,2,0,1]],Kona.TileManager.buildTiles("level-1",i),Kona.Engine.start({id:"canvas"})});