// Underscore.js 1.3.3
// (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
// Underscore is freely distributable under the MIT license.
// Portions of Underscore are inspired or borrowed from Prototype,
// Oliver Steele's Functional, and John Resig's Micro-Templating.
// For all details and documentation:
// http://documentcloud.github.com/underscore
(function(){function e(t,n,r){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return t===n;t._chain&&(t=t._wrapped),n._chain&&(n=n._wrapped);if(t.isEqual&&E.isFunction(t.isEqual))return t.isEqual(n);if(n.isEqual&&E.isFunction(n.isEqual))return n.isEqual(t);var i=a.call(t);if(i!=a.call(n))return!1;switch(i){case"[object String]":return t==""+n;case"[object Number]":return t!=+t?n!=+n:0==t?1/t==1/n:t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if("object"!=typeof t||"object"!=typeof n)return!1;for(var s=r.length;s--;)if(r[s]==t)return!0;r.push(t);var s=0,o=!0;if("[object Array]"==i){if(s=t.length,o=s==n.length)for(;s--&&(o=s in t==s in n&&e(t[s],n[s],r)););}else{if("constructor"in t!="constructor"in n||t.constructor!=n.constructor)return!1;for(var u in t)if(E.has(t,u)&&(s++,!(o=E.has(n,u)&&e(t[u],n[u],r))))break;if(o){for(u in n)if(E.has(n,u)&&!(s--))break;o=!s}}return r.pop(),o}var t=this,n=t._,r={},i=Array.prototype,s=Object.prototype,o=i.slice,u=i.unshift,a=s.toString,f=s.hasOwnProperty,l=i.forEach,c=i.map,h=i.reduce,p=i.reduceRight,d=i.filter,v=i.every,m=i.some,g=i.indexOf,y=i.lastIndexOf,s=Array.isArray,b=Object.keys,w=Function.prototype.bind,E=function(e){return new _(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=E),exports._=E):t._=E,E.VERSION="1.3.3";var S=E.each=E.forEach=function(e,t,n){if(e!=null)if(l&&e.forEach===l)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(i in e&&t.call(n,e[i],i,e)===r)break}else for(i in e)if(E.has(e,i)&&t.call(n,e[i],i,e)===r)break};E.map=E.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(S(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},E.reduce=E.foldl=E.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=E.bind(t,r)),i?e.reduce(t,n):e.reduce(t);S(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},E.reduceRight=E.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduceRight===p)return r&&(t=E.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=E.toArray(e).reverse();return r&&!i&&(t=E.bind(t,r)),i?E.reduce(s,t,n,r):E.reduce(s,t)},E.find=E.detect=function(e,t,n){var r;return x(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},E.filter=E.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(S(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},E.reject=function(e,t,n){var r=[];return e==null?r:(S(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},E.every=E.all=function(e,t,n){var i=!0;return e==null?i:v&&e.every===v?e.every(t,n):(S(e,function(e,s,o){if(!(i=i&&t.call(n,e,s,o)))return r}),!!i)};var x=E.some=E.any=function(e,t,n){t||(t=E.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,n):(S(e,function(e,s,o){if(i||(i=t.call(n,e,s,o)))return r}),!!i)};E.include=E.contains=function(e,t){var n=!1;return e==null?n:g&&e.indexOf===g?e.indexOf(t)!=-1:n=x(e,function(e){return e===t})},E.invoke=function(e,t){var n=o.call(arguments,2);return E.map(e,function(e){return(E.isFunction(t)?t||e:e[t]).apply(e,n)})},E.pluck=function(e,t){return E.map(e,function(e){return e[t]})},E.max=function(e,t,n){if(!t&&E.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&E.isEmpty(e))return-Infinity;var r={computed:-Infinity};return S(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i>=r.computed&&(r={value:e,computed:i})}),r.value},E.min=function(e,t,n){if(!t&&E.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&E.isEmpty(e))return Infinity;var r={computed:Infinity};return S(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i<r.computed&&(r={value:e,computed:i})}),r.value},E.shuffle=function(e){var t=[],n;return S(e,function(e,r){n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e}),t},E.sortBy=function(e,t,n){var r=E.isFunction(t)?t:function(e){return e[t]};return E.pluck(E.map(e,function(e,t,i){return{value:e,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n===void 0?1:r===void 0?-1:n<r?-1:n>r?1:0}),"value")},E.groupBy=function(e,t){var n={},r=E.isFunction(t)?t:function(e){return e[t]};return S(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},E.sortedIndex=function(e,t,n){n||(n=E.identity);for(var r=0,i=e.length;r<i;){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},E.toArray=function(e){return e?E.isArray(e)||E.isArguments(e)?o.call(e):e.toArray&&E.isFunction(e.toArray)?e.toArray():E.values(e):[]},E.size=function(e){return E.isArray(e)?e.length:E.keys(e).length},E.first=E.head=E.take=function(e,t,n){return t!=null&&!n?o.call(e,0,t):e[0]},E.initial=function(e,t,n){return o.call(e,0,e.length-(t==null||n?1:t))},E.last=function(e,t,n){return t!=null&&!n?o.call(e,Math.max(e.length-t,0)):e[e.length-1]},E.rest=E.tail=function(e,t,n){return o.call(e,t==null||n?1:t)},E.compact=function(e){return E.filter(e,function(e){return!!e})},E.flatten=function(e,t){return E.reduce(e,function(e,n){return E.isArray(n)?e.concat(t?n:E.flatten(n)):(e[e.length]=n,e)},[])},E.without=function(e){return E.difference(e,o.call(arguments,1))},E.uniq=E.unique=function(e,t,n){var n=n?E.map(e,n):e,r=[];return e.length<3&&(t=!0),E.reduce(n,function(n,i,s){if(t?E.last(n)!==i||!n.length:!E.include(n,i))n.push(i),r.push(e[s]);return n},[]),r},E.union=function(){return E.uniq(E.flatten(arguments,!0))},E.intersection=E.intersect=function(e){var t=o.call(arguments,1);return E.filter(E.uniq(e),function(e){return E.every(t,function(t){return E.indexOf(t,e)>=0})})},E.difference=function(e){var t=E.flatten(o.call(arguments,1),!0);return E.filter(e,function(e){return!E.include(t,e)})},E.zip=function(){for(var e=o.call(arguments),t=E.max(E.pluck(e,"length")),n=Array(t),r=0;r<t;r++)n[r]=E.pluck(e,""+r);return n},E.indexOf=function(e,t,n){if(e==null)return-1;var r;if(n)return n=E.sortedIndex(e,t),e[n]===t?n:-1;if(g&&e.indexOf===g)return e.indexOf(t);n=0;for(r=e.length;n<r;n++)if(n in e&&e[n]===t)return n;return-1},E.lastIndexOf=function(e,t){if(e==null)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);for(var n=e.length;n--;)if(n in e&&e[n]===t)return n;return-1},E.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0);for(var n=arguments[2]||1,r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);i<r;)s[i++]=e,e+=n;return s};var T=function(){};E.bind=function(e,t){var n,r;if(e.bind===w&&w)return w.apply(e,o.call(arguments,1));if(!E.isFunction(e))throw new TypeError;return r=o.call(arguments,2),n=function(){if(this instanceof n){T.prototype=e.prototype;var i=new T,s=e.apply(i,r.concat(o.call(arguments)));return Object(s)===s?s:i}return e.apply(t,r.concat(o.call(arguments)))}},E.bindAll=function(e){var t=o.call(arguments,1);return t.length==0&&(t=E.functions(e)),S(t,function(t){e[t]=E.bind(e[t],e)}),e},E.memoize=function(e,t){var n={};return t||(t=E.identity),function(){var r=t.apply(this,arguments);return E.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},E.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},E.defer=function(e){return E.delay.apply(E,[e,1].concat(o.call(arguments,1)))},E.throttle=function(e,t){var n,r,i,s,o,u,a=E.debounce(function(){o=s=!1},t);return function(){return n=this,r=arguments,i||(i=setTimeout(function(){i=null,o&&e.apply(n,r),a()},t)),s?o=!0:u=e.apply(n,r),a(),s=!0,u}},E.debounce=function(e,t,n){var r;return function(){var i=this,s=arguments;n&&!r&&e.apply(i,s),clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(i,s)},t)}},E.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},E.wrap=function(e,t){return function(){var n=[e].concat(o.call(arguments,0));return t.apply(this,n)}},E.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},E.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},E.keys=b||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[],n;for(n in e)E.has(e,n)&&(t[t.length]=n);return t},E.values=function(e){return E.map(e,E.identity)},E.functions=E.methods=function(e){var t=[],n;for(n in e)E.isFunction(e[n])&&t.push(n);return t.sort()},E.extend=function(e){return S(o.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},E.pick=function(e){var t={};return S(E.flatten(o.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},E.defaults=function(e){return S(o.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},E.clone=function(e){return E.isObject(e)?E.isArray(e)?e.slice():E.extend({},e):e},E.tap=function(e,t){return t(e),e},E.isEqual=function(t,n){return e(t,n,[])},E.isEmpty=function(e){if(e==null)return!0;if(E.isArray(e)||E.isString(e))return e.length===0;for(var t in e)if(E.has(e,t))return!1;return!0},E.isElement=function(e){return!!e&&e.nodeType==1},E.isArray=s||function(e){return a.call(e)=="[object Array]"},E.isObject=function(e){return e===Object(e)},E.isArguments=function(e){return a.call(e)=="[object Arguments]"},E.isArguments(arguments)||(E.isArguments=function(e){return!!e&&!!E.has(e,"callee")}),E.isFunction=function(e){return a.call(e)=="[object Function]"},E.isString=function(e){return a.call(e)=="[object String]"},E.isNumber=function(e){return a.call(e)=="[object Number]"},E.isFinite=function(e){return E.isNumber(e)&&isFinite(e)},E.isNaN=function(e){return e!==e},E.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},E.isDate=function(e){return a.call(e)=="[object Date]"},E.isRegExp=function(e){return a.call(e)=="[object RegExp]"},E.isNull=function(e){return e===null},E.isUndefined=function(e){return e===void 0},E.has=function(e,t){return f.call(e,t)},E.noConflict=function(){return t._=n,this},E.identity=function(e){return e},E.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},E.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},E.result=function(e,t){if(e==null)return null;var n=e[t];return E.isFunction(n)?n.call(e):n},E.mixin=function(e){S(E.functions(e),function(t){P(t,E[t]=e[t])})};var N=0;E.uniqueId=function(e){var t=N++;return e?e+t:t},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var C=/.^/,k={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"},L;for(L in k)k[k[L]]=L;var A=/\\|'|\r|\n|\t|\u2028|\u2029/g,O=/\\(\\|'|r|n|t|u2028|u2029)/g,M=function(e){return e.replace(O,function(e,t){return k[t]})};E.template=function(e,t,n){n=E.defaults(n||{},E.templateSettings),e="__p+='"+e.replace(A,function(e){return"\\"+k[e]}).replace(n.escape||C,function(e,t){return"'+\n_.escape("+M(t)+")+\n'"}).replace(n.interpolate||C,function(e,t){return"'+\n("+M(t)+")+\n'"}).replace(n.evaluate||C,function(e,t){return"';\n"+M(t)+"\n;__p+='"})+"';\n",n.variable||(e="with(obj||{}){\n"+e+"}\n");var e="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+e+"return __p;\n",r=new Function(n.variable||"obj","_",e);return t?r(t,E):(t=function(e){return r.call(this,e,E)},t.source="function("+(n.variable||"obj")+"){\n"+e+"}",t)},E.chain=function(e){return E(e).chain()};var _=function(e){this._wrapped=e};E.prototype=_.prototype;var D=function(e,t){return t?E(e).chain():e},P=function(e,t){_.prototype[e]=function(){var e=o.call(arguments);return u.call(e,this._wrapped),D(t.apply(E,e),this._chain)}};E.mixin(E),S("pop,push,reverse,shift,sort,splice,unshift".split(","),function(e){var t=i[e];_.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return(e=="shift"||e=="splice")&&r===0&&delete n[0],D(n,this._chain)}}),S(["concat","join","slice"],function(e){var t=i[e];_.prototype[e]=function(){return D(t.apply(this._wrapped,arguments),this._chain)}}),_.prototype.chain=function(){return this._chain=!0,this},_.prototype.value=function(){return this._wrapped}}).call(this);var Kona,__hasProp={}.hasOwnProperty;Kona=window.Kona={},Kona.debugMode=!0,Kona.debug=function(e){var t,n,r,i,s,o,u,a,f,l,c;if(Kona.debugMode){a=function(e){return console.log(e)},t=e!=null?"":"<undefined>",f="  ",n=_.isArray(e),o=_.isString(e),i=_.isNumber(e),r=_.isBoolean(e),s=_.isObject(e),e==null&&a("<undefined>"),(n||s)&&a("Dumping "+(n?"array":typeof e)+": "+t);if(n)return a(""+f+"["+e+"]");if(o)return a(e);if(i)return a(e);if(r)return a(e.toString());if(s){c=[];for(u in e){if(!__hasProp.call(e,u))continue;l=e[u],_.isFunction(l)?c.push(a(""+f+u+"(): <function>")):c.push(a(""+f+u+": "+l))}return c}}},window.puts=function(e){return Kona.debug(e)},Kona.readyCallbacks=[],Kona.isReady=!1,Kona.ready=function(e){return document.readyState==="complete"&&(Kona.isReady=!0),Kona.isReady&&e.call(),Kona.readyCallbacks.push(e)},Kona.DOMContentLoaded=function(){var e,t,n,r,i;if(Kona.isReady)return;Kona.isReady=!0,r=Kona.readyCallbacks,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.call());return i},document.readyState!=="complete"&&(document.addEventListener?(document.addEventListener("DOMContentLoaded",Kona.DOMContentLoaded,!1),window.addEventListener("load",Kona.DOMContentLoaded,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",Kona.DOMContentLoaded),window.attachEvent("onload",Kona.DOMContentLoaded))),Kona.Utils={findByKey:function(e,t,n){return _.find(e,function(e){return e[t]===n})},randomFromTo:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},printGrid:function(e){var t,n,r,i,s,o,u,a;r="[\n";for(s=0,u=e.length;s<u;s++){i=e[s],r+="  [";for(t=o=0,a=i.length;o<a;t=++o)n=i[t],r+=""+n,t!==i.length-1&&(r+=", ");r+="]\n"}return console.log(""+r+"]")},colorFor:function(e){switch(e){case 1:return"red";case 2:return"orange";case 3:return"blue";default:return"blank"}}},Kona.Canvas={defaults:{width:640,height:480},init:function(e){return e==null&&(e={}),this.elem=document.getElementById(e.id)||function(){throw new Error("can't find element with id: "+id)}(),this.ctx=this.elem.getContext("2d"),this.width=this.elem.width||this.defaults.width,this.height=this.elem.height||this.defaults.height},safe:function(e){return this.ctx.save(),e(),this.ctx.restore()},clear:function(){var e=this;return this.safe(function(){return e.ctx.fillStyle="white",e.ctx.fillRect(0,0,e.width,e.height)})},verticalLine:function(e){var t=this;return this.safe(function(){return t.ctx.fillStyle="red",t.ctx.fillRect(e,0,2,t.height)})},highlightColumn:function(e){var t=this;return Kona.Canvas.safe(function(){var n,r;return t.ctx.fillStyle="red",t.ctx.globalAlpha=.01,r=Kona.Tile.tileSize,n=r*Math.floor(e/r),Kona.Canvas.ctx.fillRect(n,0,r,Kona.Canvas.height)})}},Kona.Engine={defaults:{fps:24,width:640,height:480},start:function(e){return e==null&&(e={}),this.fps=e.fps||this.defaults.fps,Kona.Scenes.currentScene=Kona.Utils.findByKey(Kona.Scenes._scenes,"active",!0),this.run()},run:function(){return Kona.Scenes.drawCurrent(),requestAnimFrame(Kona.Engine.run)}},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1e3/Kona.Engine.defaults.fps)}}(),Kona.Scenes={_scenes:[],currentScene:{},drawCurrent:function(){return this.currentScene.draw()},setCurrent:function(e){return this.currentScene.active=!1,this.currentScene=Kona.Utils.findByKey(this._scenes,"name",e),this.currentScene.active=!0}},Kona.Scene=function(){function e(e){e==null&&(e={}),this.active=e.active||!1,this.name=e.name||function(){throw new Error("scene must have a name")}(),this.background=new Image,this.background.src=e.background||"",this.entities=[],Kona.Scenes._scenes.push(this)}return e.prototype.addEntity=function(e){return this.entities.push(e)},e.prototype.update=function(){},e.prototype.draw=function(){var e,t,n,r,i;Kona.Canvas.clear(),Kona.Canvas.ctx.drawImage(this.background,0,0),Kona.TileManager.draw(this.name),r=this.entities,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],e.update(),i.push(e.draw());return i},e}();var __bind=function(e,t){return function(){return e.apply(t,arguments)}};Kona.Entity=function(){function e(e){e==null&&(e={}),this.onSurface=__bind(this.onSurface,this),this.eachSolidTile=__bind(this.eachSolidTile,this),this.solid=!0,this.position={x:e.x||0,y:e.y||0},this.direction={dx:e.dx||0,dy:e.dy||0},this.box={width:e.width||0,height:e.height||0},this.sprite=new Image,this.sprite.src=""}return e.grav=8,e.prototype.update=function(){},e.prototype.draw=function(){},e.prototype.top=function(){return this.position.y},e.prototype.bottom=function(){return this.position.y+this.box.height},e.prototype.left=function(){return this.position.x},e.prototype.right=function(){return this.position.x+this.box.width},e.prototype.futureTop=function(){return this.top()+this.direction.dy},e.prototype.futureBottom=function(){return this.bottom()+this.direction.dy},e.prototype.futureLeft=function(){return this.left()+this.direction.dx},e.prototype.futureRight=function(){return this.right()+this.direction.dx},e.prototype.movingLeft=function(){return this.direction.dx<0},e.prototype.movingRight=function(){return this.direction.dx>0},e.prototype.addGravity=function(){return this.position.y+=Kona.Entity.grav},e.prototype.setPosition=function(e,t){return this.position.x=e,this.position.y=t},e.prototype.stop=function(e){if(e!=null)return _.contains(["dx","dy"],e)||function(){throw new Error("Axis "+e+" not recognized")}(),this.direction[e]=0},e.prototype.inRowSpace=function(e){return this.futureBottom()>e.top()&&this.futureTop()<e.bottom()},e.prototype.inColumnSpace=function(e){return this.futureLeft()<e.right()&&this.futureRight()>e.left()},e.prototype.eachSolidTile=function(e){var t,n,r,i,s,o;s=Kona.TileManager.columnsFor(this),o=[];for(r=0,i=s.length;r<i;r++)t=s[r],o.push(function(){var r,i,s;s=[];for(r=0,i=t.length;r<i;r++)n=t[r],n.solid?s.push(e(n)):s.push(void 0);return s}());return o},e.prototype.isCollision=function(e){var t,n=this;return t=!1,this.eachSolidTile(function(n){if(e(n))return t=!0}),t},e.prototype.leftCollision=function(){var e=this;return this.isCollision(function(t){return e.right()>=t.right()&&e.futureLeft()<=t.right()&&e.inRowSpace(t)})},e.prototype.rightCollision=function(){var e=this;return this.isCollision(function(t){return e.left()<=t.left()&&e.futureRight()>=t.left()&&e.inRowSpace(t)})},e.prototype.topCollision=function(){var e=this;return this.isCollision(function(t){return e.bottom()>=t.bottom()&&e.futureTop()<=t.bottom()&&e.inColumnSpace(t)})},e.prototype.bottomCollision=function(){var e=this;return this.isCollision(function(t){return e.top()<=t.top()&&e.futureBottom()>=t.top()&&e.inColumnSpace(t)})},e.prototype.onSurface=function(){var e,t,n,r,i,s,o;o=Kona.TileManager.columnsFor(this);for(n=0,i=o.length;n<i;n++){e=o[n];for(r=0,s=e.length;r<s;r++){t=e[r];if(t.solid&&t.position.y===this.bottom()+1)return!0}}return!1},e.prototype.correctLeft=function(){var e;e=[];while(this.leftCollision())e.push(this.position.x+=1);return e},e.prototype.correctRight=function(){var e;e=[];while(this.rightCollision())e.push(this.position.x-=1);return e},e.prototype.correctTop=function(){var e;e=[];while(this.topCollision())e.push(this.position.y+=1);return e},e.prototype.correctBottom=function(){var e;e=[];while(this.bottomCollision())e.push(this.position.y-=1);return e},e}();var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};Kona.TileManager={sceneTilemap:{},buildTiles:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;(a=this.sceneTilemap)[e]||(a[e]=[]),o=0,u=Kona.Canvas.height-t.length*Kona.Tile.tileSize,i=[],p=[];for(f=0,c=t.length;f<c;f++){r=t[f];for(l=0,h=r.length;l<h;l++)n=r[l],s=n===0?new Kona.BlankTile({x:o,y:u}):new Kona.Tile({color:n,x:o,y:u}),i.push(s),o+=Kona.Tile.tileSize;o=0,u+=Kona.Tile.tileSize,this.sceneTilemap[e].push(i),p.push(i=[])}return p},draw:function(e){var t,n,r,i,s,o;s=this.sceneTilemap[e],o=[];for(r=0,i=s.length;r<i;r++)t=s[r],o.push(function(){var e,r,i;i=[];for(e=0,r=t.length;e<r;e++)n=t[e],i.push(n.draw());return i}());return o},currentTiles:function(){return this.sceneTilemap[Kona.Scenes.currentScene.name]},columnFor:function(e){return _.map(this.currentTiles(),function(t){return t[e]})},columnsFor:function(e){var t,n,r,i,s,o=this;return n=Kona.Tile.tileSize,r=Math.floor(e.position.x/n),t=Math.floor(e.right()/n),_.map(function(){s=[];for(var e=r;r<=t?e<=t:e>=t;r<=t?e++:e--)s.push(e);return s}.apply(this),function(e){return o.columnFor(e)})}},Kona.Tile=function(e){function t(e){e==null&&(e={}),t.__super__.constructor.call(this,e),this.size=Kona.Tile.tileSize,this.box={width:this.size,height:this.size},this.color=e.color||-1}return __extends(t,e),t.tileSize=60,t.prototype.toString=function(){return"<Tile @x="+this.position.x+", @y="+this.position.y+", @color="+Kona.Utils.colorFor(this.color)+">"},t.prototype.draw=function(){var e=this;return Kona.Canvas.safe(function(){return Kona.Canvas.ctx.fillStyle=e.colorName(),Kona.Canvas.ctx.fillRect(e.position.x,e.position.y,e.box.width,e.box.height)})},t.prototype.colorName=function(){return Kona.Utils.colorFor(this.color)},t}(Kona.Entity),Kona.BlankTile=function(e){function t(e){t.__super__.constructor.call(this,e),this.solid=!1,this.size=Kona.Tile.tileSize,this.box={width:this.size,height:this.size}}return __extends(t,e),t.prototype.toString=function(){return"<BlankTile>"},t.prototype.draw=function(){},t}(Kona.Tile),Kona.Keys={_handlers:{},_keycodes:{enter:13,"return":13,esc:27,escape:27,ctrl:17,control:17,left:37,up:38,right:39,down:40,shift:16,space:32},_names:{13:"enter",16:"shift",17:"ctrl",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z"},bind:function(e,t){var n,r;return e=e.replace(/\s/g,""),n=this._keycodes[e]||e.toUpperCase().charCodeAt(0),(r=this._handlers)[n]||(r[n]=[]),this._handlers[n].push(t)},dispatch:function(e){var t,n,r,i,s,o;n=this.eventKeyCode(e);if(this.reject(e)||this._handlers[n]==null)return;s=this._handlers[n],o=[];for(r=0,i=s.length;r<i;r++)t=s[r],t.call(e),o.push(!1);return o},reject:function(e){return _.contains(["INPUT","SELECT","TEXTAREA"],e.target.tagName)},keycodeName:function(e){return this._names[this.eventKeyCode(e)]},eventKeyCode:function(e){return e.which||e.keyCode}},Kona.ready(function(){return document.body.onkeydown=function(e){var t;t=Kona.Keys.keycodeName(e);if(Kona.Keys.keydown)return Kona.Keys.keydown(t)},document.body.onkeyup=function(e){var t;t=Kona.Keys.keycodeName(e);if(Kona.Keys.keyup)return Kona.Keys.keyup(t)},document.addEventListener("keydown",Kona.Keys.dispatch.bind(Kona.Keys),!1)}),Kona.Sound=function(){function e(e,t){var n,r,i,s,o,u,a,f,l,c=this;t==null&&(t={}),this.supported=Kona.Sound.isSupported();if(this.supported&&e!=null){f=Kona.Sound.defaults;for(n in f)i=f[n],t[n]=t[n]||i}this.el=document.createElement("audio");if(_.isArray(e))for(s=0,u=e.length;s<u;s++)r=e[s],this.addSource(this.el,r);else if(t.formats!=null&&t.formats.length){l=t.formats;for(i=o=0,a=l.length;o<a;i=++o)n=l[i],this.addSource(this.el,""+e+"."+n)}else this.addSource(this.el,e);t.autoplay===!0&&(this.el.autoplay="autoplay"),t.preload===!0?this.el.preload="auto":t.preload===!1&&(this.el.preload="none"),this.setVolume(t.volume),this.el.addEventListener("loadedmetadata",function(){return c.duration=c.el.duration}),Kona.Sound.sounds.push(this)}return e.defaults={autoplay:!1,duration:5e3,formats:[],loop:!1,placeholder:"--",preload:"metadata",volume:100},e.types={mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",m4a:"audio/x-m4a"},e.sounds=[],e.testEl=document.createElement("audio"),e.isSupported=function(){return!!this.testEl.canPlayType},e.isOGGSupported=function(){return this.testEl.canPlayType('audio/ogg codecs="vorbis"')},e.isWAVSupported=function(){return this.testEl.canPlayType('audio/wav codecs="1"')},e.isMP3Supported=function(){return this.testEl.canPlayType('audio/mpeg codecs="mp3"')},e.isAACSupported=function(){return this.testEl.canPlayType("audio/x-m4a")||this.testEl.canPlayType("audio/aac")},e.supportedFormats=function(){var e;return e=function(e){return e===""?"yes":e},Kona.debug("Audio format compatability:"),Kona.debug("  OGG: "+e(this.isOGGSupported())),Kona.debug("  WAV: "+e(this.isWAVSupported())),Kona.debug("  MP3: "+e(this.isMP3Supported())),Kona.debug("  AAC: "+e(this.isAACSupported()))},e.prototype.getExt=function(e){return e.split(".").pop()},e.prototype.addSource=function(e,t){var n,r;return r=document.createElement("source"),r.src=t,n=this.getExt(t),Kona.Sound.types[n]!=null&&(r.type=Kona.Sound.types[n]),e.appendChild(r)},e.prototype.load=function(){return this.supported?this.el.load():this},e.prototype.play=function(){return this.supported?this.el.play():this},e.prototype.togglePlay=function(){return this.supported?(this.el.paused?this.el.play():this.el.pause(),this):this},e.prototype.pause=function(){return this.supported?this.el.pause():this},e.prototype.isPaused=function(){return this.supported?this.el.paused:null},e.prototype.stop=function(){return this.supported?(this.el.currentTime=this.el.duration,this.el.pause()):null},e.prototype.isEnded=function(){return this.supported?this.el.ended:null},e.prototype.getDuration=function(){return this.supported?this.duration:null},e.prototype.mute=function(){return this.supported?this.el.muted=!0:null},e.prototype.unmute=function(){return this.supported?this.el.muted=!1:null},e.prototype.isMuted=function(){return this.supported?this.el.muted:null},e.prototype.toggleMute=function(){return this.supported?this.el.muted=!this.el.muted:null},e.prototype.setVolume=function(e){return this.supported?(e<0&&(e=0),e>100&&(e=100),this.volume=e,this.el.volume=e/100,this):this},e.prototype.getVolume=function(){return this.supported?this.volume:null},e.prototype.increaseVolume=function(e){return e==null&&(e=1),this.setVolume(this.volume+e)},e.prototype.decreaseVolume=function(e){return e==null&&(e=1),this.setVolume(this.volume-e)},e.prototype.getTime=function(){var e;return this.supported?(e=Math.round(this.el.currentTime*100)/100,isNaN(e)?Kona.Sound.defaults.placeholder:e):null},e.prototype.getDuration=function(){return this.supported?this.el.duration:null},e}();var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};Kona.ready(function(){var e,t,n,r,i;return Kona.beat=function(){return console.log("Heartbeat!")},window._k_once=0,window.once=function(e){return window._k_once===0&&e(),window._k_once++},Kona.Canvas.init({id:"canvas"}),t=new Kona.Scene({name:"level-1",active:!0}),e=function(e){function t(e){e==null&&(e={}),this.jumpHeight=12,this.isJumping=!1,t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.update=function(){return this.position.x+=this.direction.dx,this.correctLeft(),this.correctRight(),this.isJumping?(this.position.y-=this.jumpHeight,this.correctTop()):(this.addGravity(),this.correctBottom()),this.top()>Kona.Canvas.height&&this.die(),Kona.Canvas.ctx.fillRect(this.position.x,this.position.y,this.box.width,this.box.height)},t.prototype.jump=function(){var e,t=this;e=175;if(this.isJumping)return!1;if(this.onSurface())return this.isJumping=!0,setTimeout(function(){return t.isJumping=!1},e)},t.prototype.die=function(){var e=this;return setTimeout(function(){return e.setPosition(195,200)},400)},t}(Kona.Entity),r=new e({x:220,y:200,width:30,height:60}),t.addEntity(r),n=3,Kona.Keys.keydown=function(e){switch(e){case"left":return r.direction.dx=-n;case"right":return r.direction.dx=n;case"up":return r.jump()}},Kona.Keys.keyup=function(e){switch(e){case"left":case"right":return r.stop("dx");case"up":case"down":return r.stop("dy")}},i=[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,2,3,1],[1,3,0,0,0,0,0,0,0,0,2],[2,0,0,0,0,0,0,0,0,0,3],[1,0,0,2,0,0,3,2,3,0,2],[3,2,1,3,1,0,0,1,2,0,1]],Kona.TileManager.buildTiles("level-1",i),Kona.Engine.start({id:"canvas"})});