(function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Kona.ready(function(){var t,i,n,r,o,s,u,a,p;return Kona.Canvas.init("canvas"),Kona.Sounds.load({weapon_pickup:"audio/weapon_pickup.mp3",enemy_fire:"audio/enemy_fire.ogg",player_fire:"audio/player_fire.mp3"}),a=function(t){function i(t){null==t&&(t={}),i.__super__.constructor.call(this,t),this.speed=3,this.jumpHeight=13,this.jumpDuration=180,this.isJumping=!1,this.facing="right",this.canFire=!1,this.currentWeapon=null,this.collects("coins","weapons")}return e(i,t),i.prototype.update=function(){return i.__super__.update.call(this),this.isJumping?(this.position.y-=this.jumpHeight,this.correctTop()):this.addGravity(),this.top()>Kona.Canvas.height&&this.die(),this.right()>Kona.Canvas.width-20?(Kona.Scenes.nextScene(),Kona.Scenes.currentScene.addEntity(p),this.setPosition(0,this.top())):void 0},i.prototype.stop=function(t){return this.setAnimation("idle_"+this.facing),i.__super__.stop.call(this,t)},i.prototype.setDirection=function(t){return this.setAnimation("run_"+t),this.direction.dx="left"===t?-1:1},i.prototype.jump=function(){var t=this;return!this.isJumping&&this.onSurface()?(this.isJumping=!0,this.position.y-=25,setTimeout(function(){return t.isJumping=!1,t.resetAnimation()},this.jumpDuration)):void 0},i.prototype.fire=function(){return null!=this.currentWeapon?this.currentWeapon.fire():void 0},i.prototype.reset=function(){return this.facing="right",this.resetAnimation(),this.setPosition(195,200)},i.prototype.resetAnimation=function(){return 0!==this.direction.dx?this.setAnimation("run_"+this.facing):this.setAnimation("idle_"+this.facing)},i}(Kona.Entity),n=function(t){function i(t){null==t&&(t={}),i.__super__.constructor.call(this,t),this.currentWeapon=new r({group:"enemy_weapons",holder:this}),Kona.Scenes.currentScene.addEntity(this.currentWeapon)}return e(i,t),i.prototype.update=function(){return i.__super__.update.call(this),this.addGravity()},i.prototype.destroy=function(){return this.currentWeapon.destroy(),i.__super__.destroy.apply(this,arguments)},i}(Kona.Entity),s=function(t){function n(t){null==t&&(t={}),n.__super__.constructor.call(this,t),this.recharge=500,this.projType=u,this.projSound="player_fire"}return e(n,t),n.prototype.fire=function(){var t;return this.canFire&&(this.holder.setAnimation("fire_"+this.holder.facing),t="right"===this.holder.facing?this.holder.right()+2:this.holder.left()-17,Kona.Scenes.currentScene.addEntity(new i({group:"effects",x:t,y:this.holder.top()+2,duration:30,sprite:"img/effects/rifle_fire_"+this.holder.facing+".png"}))),n.__super__.fire.call(this)},n.prototype.activate=function(t){return Kona.Sounds.play("weapon_pickup"),n.__super__.activate.call(this,t)},n}(Kona.Weapon),u=function(t){function i(t){null==t&&(t={}),i.__super__.constructor.call(this,t),this.sprite.src="img/weapons/bullet_1.jpg",this.destructibles=["enemies"],this.box={width:15,height:10}}return e(i,t),i}(Kona.Projectile),o=function(t){function i(t){null==t&&(t={}),i.__super__.constructor.call(this,t),this.destructibles=[]}return e(i,t),i}(u),r=function(t){function i(t){var e=this;null==t&&(t={}),i.__super__.constructor.call(this,t),this.targets=["player"],this.recharge=1e3,this.projType=o,setInterval(function(){return e.fire()},this.recharge)}return e(i,t),i}(Kona.EnemyWeapon),t=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.value=10,i.prototype.activate=function(){return puts("Coin activated!")},i}(Kona.Collectable),i=function(t){function i(t){var e=this;null==t&&(t={}),i.__super__.constructor.call(this,t),this.solid=!1,this.duration=t.duration||fail("Effect must have a duration"),setTimeout(function(){return e.destroy()},this.duration)}return e(i,t),i.prototype.update=function(){},i}(Kona.Entity),p=new a({group:"player",x:200,y:200,width:55,height:65}),p.loadAnimations({idle_right:{sheet:"img/entities/marine_idle_right.png",active:!0},idle_left:{sheet:"img/entities/marine_idle_left.png"},run_right:{sheet:"img/entities/marine_run_right.png"},run_left:{sheet:"img/entities/marine_run_left.png"}}),Kona.Scenes.currentScene.addEntity(p),Kona.Keys.keydown=function(t){switch(t){case"left":return p.setDirection("left");case"right":return p.setDirection("right");case"up":return p.jump();case"space":return p.fire()}},Kona.Keys.keyup=function(t){switch(t){case"left":case"right":return p.stop("dx");case"up":case"down":return p.stop("dy")}},Kona.Scenes.definitionMap={"-":{group:"tiles",entity:Kona.BlankTile},d:{group:"tiles",entity:Kona.Tile,opts:{sprite:"img/tiles/dirt1.png"}},l:{group:"tiles",entity:Kona.Tile,opts:{sprite:"img/tiles/dirt_left.png"}},r:{group:"tiles",entity:Kona.Tile,opts:{sprite:"img/tiles/dirt_right.png"}},x:{group:"enemies",entity:n,opts:{width:45,height:58,offset:{x:5}}},c:{group:"coins",entity:t,opts:{offset:{x:20,y:20},sprite:"img/powerups/coin.png"}},p:{group:"weapons",entity:s,opts:{offset:{x:15,y:15},sprite:"img/weapons/pistol.png"}}},Kona.Scenes.loadScenes([{background:"img/backgrounds/lvl2.jpg",entities:[["-","-","-","-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-","-","-","l"],["d","r","-","-","-","-","-","-","-","l","d"],["d","-","-","-","-","-","-","-","-","-","-"],["d","c","c","d","-","-","-","d","-","-","-"],["d","d","d","d","d","-","l","d","r","-","r"]]},{background:"img/backgrounds/lvl2.jpg",entities:[["-","-","-","-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-","-","-","-"],["d","d","r","-","-","-","-","-","-","-","-"],["-","-","-","-","-","l","d","r","-","-","-"],["-","-","-","-","l","-","-","-","-","-","-"],["-","-","-","l","d","c","-","-","-","l","d"],["d","r","-","d","d","d","d","d","d","d","d"]]}]),Kona.Engine.start()})}).call(this);