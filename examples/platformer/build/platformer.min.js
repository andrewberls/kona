// Generated by CoffeeScript 1.3.3
var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};Kona.ready(function(){var e,t,n,r,i,s,o,u,a,f,l;return Kona.Canvas.init("canvas"),Kona.Sounds.load({fire:"audio/enemy_fire.ogg"}),a=new Kona.Scene({name:"lvl1:s1",background:"img/backgrounds/lvl2.jpg",active:!0}),f=new Kona.Scene({name:"lvl1:s2",background:"img/backgrounds/lvl2.jpg"}),t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(Kona.Tile),u=function(e){function t(e){e==null&&(e={}),t.__super__.constructor.call(this,e),this.speed=2,this.jumpHeight=12,this.jumpDuration=180,this.isJumping=!1,this.facing="",this.canFire=!1,this.currentWeapon=null,this.collects("coins","weapons")}return __extends(t,e),t.prototype.update=function(){t.__super__.update.call(this),this.isJumping?(this.position.y-=this.jumpHeight,this.correctTop()):this.addGravity(),this.top()>Kona.Canvas.height&&this.die();if(this.right()>Kona.Canvas.width-20)return Kona.Scenes.nextScene(),Kona.Scenes.currentScene.addEntity(l),this.setPosition(0,this.top())},t.prototype.stop=function(e){return this.setAnimation("idle"),t.__super__.stop.call(this,e)},t.prototype.setDirection=function(e){return this.setAnimation("run_"+e),this.direction.dx=e==="left"?-1:1},t.prototype.jump=function(){var e=this;if(!this.isJumping&&this.onSurface())return this.isJumping=!0,this.position.y-=20,setTimeout(function(){e.isJumping=!1;if(e.facing!==""&&e.direction.dx!==0)return e.setAnimation("run_"+e.facing)},this.jumpDuration)},t.prototype.fire=function(){puts(this.facing);if(this.currentWeapon!=null)return this.currentWeapon.fire()},t.prototype.die=function(){var e=this;return setTimeout(function(){return e.facing="right",e.setPosition(195,200)},400)},t}(Kona.Entity),n=function(e){function t(e){e==null&&(e={}),t.__super__.constructor.call(this,e),this.currentWeapon=new r({group:"enemy_weapons",holder:this}),a.addEntity(this.currentWeapon)}return __extends(t,e),t.prototype.update=function(){return t.__super__.update.apply(this,arguments),this.addGravity()},t.prototype.destroy=function(){return this.currentWeapon.destroy(),t.__super__.destroy.apply(this,arguments)},t}(Kona.Entity),e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.activate=function(e){return puts("Coin activated!")},t}(Kona.Collectable),s=function(e){function t(e){e==null&&(e={}),t.__super__.constructor.call(this,e),this.recharge=150,this.projType=o,this.projSound="fire"}return __extends(t,e),t}(Kona.Weapon),o=function(e){function t(e){e==null&&(e={}),t.__super__.constructor.call(this,e),this.destructibles=["enemies"],this.box={width:15,height:10}}return __extends(t,e),t.prototype.draw=function(){var e=this;return Kona.Canvas.safe(function(){return Kona.Canvas.ctx.fillStyle="blue",Kona.Canvas.ctx.fillRect(e.position.x,e.position.y,e.box.width,e.box.height)})},t}(Kona.Projectile),i=function(e){function t(e){e==null&&(e={}),t.__super__.constructor.call(this,e),this.destructibles=[]}return __extends(t,e),t}(o),r=function(e){function t(e){var n=this;e==null&&(e={}),t.__super__.constructor.call(this,e),this.targets=["player"],this.recharge=1e3,this.projType=i,setInterval(function(){return n.fire()},this.recharge)}return __extends(t,e),t.prototype.draw=function(){var e=this;return Kona.Canvas.safe(function(){return Kona.Canvas.ctx.fillStyle="red",Kona.Canvas.ctx.fillRect(e.position.x,e.position.y,e.box.width,e.box.height)})},t}(Kona.EnemyWeapon),l=new u({x:200,y:200,width:64,height:64,color:"black",group:"player"}),l.loadAnimations({idle:{sheet:"img/entities/monster_idle.png"},run_left:{sheet:"img/entities/monster_run_left.png"},run_right:{sheet:"img/entities/monster_run_right.png"}}),l.setAnimation("idle"),a.addEntity(l),Kona.Keys.keydown=function(e){switch(e){case"left":return l.setDirection("left");case"right":return l.setDirection("right");case"up":return l.jump();case"space":return l.fire()}},Kona.Keys.keyup=function(e){switch(e){case"left":case"right":return l.stop("dx");case"up":case"down":return l.stop("dy")}},Kona.Scenes.definitionMap={"-":{group:"tiles",klass:Kona.BlankTile},r:{group:"tiles",klass:t,opts:{sprite:"img/tiles/dirt1.png"}},o:{group:"tiles",klass:t,opts:{sprite:"img/tiles/dirt1.png"}},b:{group:"tiles",klass:t,opts:{sprite:"img/tiles/dirt1.png"}},x:{group:"enemies",klass:n,opts:{width:40,height:60,offset:{x:15},sprite:"img/entities/ninja1.png"}},c:{group:"coins",klass:e,opts:{width:25,height:25,offset:{x:20,y:20},sprite:"img/powerups/coin.png"}},p:{group:"weapons",klass:s,opts:{width:50,height:25,offset:{x:15,y:15},sprite:"img/weapons/pistol.png"}}},a.loadEntities([["-","-","-","-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-","-","o","b"],["r","b","-","-","-","-","-","-","r","-","-"],["o","-","-","-","-","-","-","x","-","-","-"],["r","c","c","o","p","-","b","o","-","-","-"],["b","o","r","b","r","-","-","r","o","-","r"]]),f.loadEntities([["-","-","-","-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-","-","-","-"],["b","r","o","-","-","-","-","-","-","-","-"],["-","-","-","-","-","r","r","r","-","-","-"],["-","-","-","-","r","r","-","-","-","-","-"],["-","-","-","r","r","c","-","-","-","r","r"],["o","b","-","r","r","r","r","r","r","r","r"]]),Kona.Engine.start()});